name: CD-main-pipeline

on:
  workflow_dispatch:
    
  
  repository_dispatch:
    types: [ci_main_pipeline_done]
  
jobs:
    cd_pipeline_job:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - name: Testing 
          run: |
            cd deployment || exit
            echo ${{ github.event.client_payload.message.version }}
        - name: Delete old servers from Heroku staging env
          run: ./destroy.sh "prod" mica97@email.com ${{secrets.HEROKU_PROD_TOKEN}} ${{ github.event.client_payload.message.version }} pgb1 
        - name: Deploy to staging env on Heroku
          run: ./deploy.sh "prod" mica97@email.com ${{secrets.HEROKU_PROD_TOKEN}} ${{ github.event.inputs.name }} pgb1 
          
